"""Generated Apollonian gasket data for AdaptiveCAD fields."""

import numpy as np

# Circle data: [x, y, radius, curvature, depth]
CIRCLES = np.array([
    [0.53589838, 0.00000000, 0.46410162, 2.15470054, 0],
    [-0.26794919, 0.46410162, 0.46410162, 2.15470054, 0],
    [-0.26794919, -0.46410162, 0.46410162, 2.15470054, 0],
    [0.38799538, 0.67202771, 0.22400924, 4.46410162, 1],
    [0.38799538, -0.67202771, 0.22400924, 4.46410162, 1],
    [0.25866359, -0.00000000, 0.22400924, 4.46410162, 1],
    [0.00000000, -0.00000000, 0.07179677, 13.92820323, 1],
    [0.69920954, 0.55048475, 0.11009695, 9.08290377, 2],
    [0.69920954, -0.55048475, 0.11009695, 9.08290377, 2],
    [0.50851603, -0.00000000, 0.11009695, 9.08290377, 2],
    [0.00000000, 0.00000000, 0.46410162, 2.15470054, 2],
    [0.05123257, -0.00001000, 0.04435179, 22.54700538, 2],
    [0.15150153, 0.00002959, 0.13125423, 7.61880215, 2],
    [0.12712901, 0.88077560, 0.11009695, 9.08290377, 2],
    [0.19069351, 0.33029085, 0.11009695, 9.08290377, 2],
    [-0.02558809, 0.04436370, 0.04435179, 22.54700538, 2],
    [-0.07583419, 0.13121896, 0.13125423, 7.61880215, 2],
    [0.12712901, 0.00000000, 0.11009695, 9.08290377, 2],
    [0.19069351, -0.33029085, 0.11009695, 9.08290377, 2],
    [-0.02560541, -0.04437371, 0.04435179, 22.54700538, 2],
    [-0.07578294, -0.13118938, 0.13125423, 7.61880215, 2],
    [0.71368599, -0.00000000, 0.06867447, 14.56145281, 2],
    [0.43614144, 0.34337233, 0.06867447, 14.56145281, 2],
    [0.05658232, 0.09795646, 0.03265168, 30.62629286, 2],
    [0.43614144, -0.34337233, 0.06867447, 14.56145281, 2],
    [0.05656957, -0.09797855, 0.03265168, 30.62629286, 2],
    [0.03771730, -0.00000736, 0.03265168, 30.62629286, 2],
    [0.27757870, 0.00005421, 0.24048192, 4.15831683, 2],
    [0.24903223, 0.43133648, 0.05391706, 18.54700538, 2],
    [0.32424228, -0.07422038, 0.05391706, 18.54700538, 2],
    [0.20926239, 0.16979236, 0.05391706, 18.54700538, 2],
    [0.05046694, 0.08741129, 0.02913710, 34.32050808, 2],
    [0.32424228, 0.07422038, 0.05391706, 18.54700538, 2],
    [0.24903223, -0.43133648, 0.05391706, 18.54700538, 2],
    [0.20926239, -0.16979236, 0.05391706, 18.54700538, 2],
    [0.05046694, -0.08741130, 0.02913710, 34.32050808, 2],
    [0.53470810, -0.00000000, 0.04237392, 23.59942206, 2],
    [0.39608631, 0.23778047, 0.04237392, 23.59942206, 2],
    [0.15593763, 0.12276904, 0.02455381, 40.72687889, 2],
    [0.39608631, -0.23778047, 0.04237392, 23.59942206, 2],
    [0.15593763, -0.12276905, 0.02455381, 40.72687889, 2],
    [0.11340919, -0.00000000, 0.02455381, 40.72687889, 2],
    [0.16010246, 0.00559011, 0.05391706, 18.54700538, 2],
    [0.16010246, -0.00559011, 0.05391706, 18.54700538, 2],
    [0.00000000, 0.00000000, 0.05391706, 18.54700538, 2],
    [0.03364462, 0.00000000, 0.02913710, 34.32050808, 2],
    [0.39419718, 0.08813011, 0.04237392, 23.59942206, 2],
    [0.19571675, 0.33899135, 0.04237392, 23.59942206, 2],
    [0.02835230, 0.19643047, 0.02455381, 40.72687889, 2],
    [0.25482503, -0.05833049, 0.04237392, 23.59942206, 2],
    [0.04252845, 0.07366142, 0.02455381, 40.72687889, 2],
    [0.39419718, -0.08813011, 0.04237392, 23.59942206, 2],
    [0.25482503, 0.05833049, 0.04237392, 23.59942206, 2],
    [0.19571675, -0.33899135, 0.04237392, 23.59942206, 2],
    [0.02835230, -0.19643047, 0.02455381, 40.72687889, 2],
    [0.04252845, -0.07366143, 0.02455381, 40.72687889, 2],
    [0.43729638, -0.00000000, 0.03465435, 28.85640646, 2],
    [0.22167934, -0.00000000, 0.02133110, 46.87989766, 2],
    [0.13547071, 0.10665552, 0.02133110, 46.87989766, 2],
    [0.13547071, -0.10665553, 0.02133110, 46.87989766, 2],
])


def sphere_sdf(p, center, radius):
    """SDF for a sphere at center with given radius."""
    return np.linalg.norm(p - center, axis=-1) - radius

def apollonian_spheres_sdf(p, extrude_height=1.0):
    """
    SDF for extruded Apollonian spheres.
    
    Args:
        p: Query points as (..., 3) array
        extrude_height: Height to extrude circles into cylinders
        
    Returns:
        SDF values
    """
    # Convert 2D circles to 3D cylinders
    distances = []
    for circle_data in CIRCLES:
        x, y, r = circle_data[:3]
        center_2d = np.array([x, y])
        
        # Cylinder SDF: max(circle_distance, height_distance)
        p_xy = p[..., :2]
        p_z = p[..., 2]
        
        circle_dist = np.linalg.norm(p_xy - center_2d, axis=-1) - r
        height_dist = np.abs(p_z) - extrude_height/2
        
        cylinder_dist = np.maximum(circle_dist, height_dist)
        distances.append(cylinder_dist)
    
    # Union of all cylinders (minimum distance)
    return np.minimum.reduce(distances) if distances else np.full(p.shape[:-1], float('inf'))

def apollonian_coloring(p):
    """
    Generate color values based on circle properties.
    
    Returns:
        RGB colors based on curvature and depth
    """
    colors = np.zeros(p.shape[:-1] + (3,))
    
    for i, circle_data in enumerate(CIRCLES):
        x, y, r, k, depth = circle_data
        center_2d = np.array([x, y])
        
        # Distance to circle center (2D)
        p_xy = p[..., :2]
        dist_to_center = np.linalg.norm(p_xy - center_2d, axis=-1)
        
        # Points inside this circle
        inside = dist_to_center < r
        
        if np.any(inside):
            # Color by curvature (red) and depth (green/blue)
            curvature_color = min(k / 10.0, 1.0)  # Normalize curvature
            depth_color = depth / max(CIRCLES[:, 4])  # Normalize depth
            
            colors[inside, 0] = curvature_color  # Red channel
            colors[inside, 1] = depth_color      # Green channel  
            colors[inside, 2] = 1.0 - depth_color  # Blue channel
    
    return colors
